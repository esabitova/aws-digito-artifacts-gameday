---
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  MountFailureMetric:
    Type: AWS::Logs::MetricFilter
    Properties:
      FilterPattern: "Mount failed"
      LogGroupName: "/aws/efs/utils"
      MetricTransformations:
        - MetricValue: "1"
          DefaultValue: "0"
          MetricNamespace: "EFSMounts"
          MetricName: 'MountFailures'
    MountFailureAlarm:
      AlarmName: ${AlarmName}
      Type: "AWS::CloudWatch::Alarm"
      Properties:
        AlarmDescription: "efs:alarm:ec2-mount-failure:2020-04-01"
        ActionsEnabled: false
        MetricName: 'MountFailures'
        Namespace: EFSMounts
        Statistic: Maximum
        Period: 60
        EvaluationPeriods: 5
        DatapointsToAlarm: 1
        Threshold: 0
        ComparisonOperator: GreaterThanThreshold
        TreatMissingData: notBreaching
        Unit: None
