# Configuration for pytest; enable coverage, emit
# XML, HTML, and terminal reports.
[tool:pytest]
xfail_strict = true
addopts =
    --verbose
    --ignore=build/private
    --cov-report term-missing
    --cov resource_manager/src
    --cov documents/util/scripts/src
    --cov artifact_generator/src
    --cov adk/src
    --cov-report html:documentation/coverage
    --cov-report xml:documentation/coverage/coverage.xml
    -m unit_test
    --cov-fail-under 91

# Live Logs: https://docs.pytest.org/en/stable/logging.html#live-logs
log_cli=True
log_cli_level=INFO

# Markers: https://docs.pytest.org/en/stable/example/markers.html#registering-markers
markers=
    #test types
    alarm
    integration
    metadata_validator
    ssm_document_validator
    style_validator
    unit_test
    #services
    api-gw
    app-common
    asg
    asg_clb
    docdb
    dynamodb
    ec2
    ebs
    elb
    ecs
    efs
    elasticache
    lambda
    natgw
    rds
    s3
    sqs
    ecs
    #spec types
    asg_az_outage
    asg_cpu_stress
    asg_kill_process
    asg_network_unavailable
    asg_node_replace
    asg_scale_out
    asg_scale_up
    aurora_lag
    connections
    cpu
    disk
    drained_burst
    ec2_reboot
    errors
    failover
    fix_integ_test_stalled_resources
    force_maz_failover
    instance_reboot
    invocations
    kill_process
    lag
    many_unhealthy
    memory
    multiple_unhealthy
    network_unavailable
    procstate
    promote_non_aurora_replica
    rds_backtrack
    read_throughput
    req
    status_failed
    stress
    synthetics
    throttles
    write_throughput

# Additional coverage.py settings. The parallel flag and source values are
# necessary so that pytest-cov knows to alias the brazil build artifact absolute
# paths to the relative ones from your package source.
[coverage:run]
branch = False
parallel = False

# Flake8 configuration to check code style.
[flake8]
ignore =
    E203,  # not pep8, black adds whitespace before ':'
    W503,  # not pep8, black adds line break before binary operator
    W605,
exclude =
    resource_manager/src/config.py
    get-pip.py
    .eggs/
    *venv/*
    *package/*
max_line_length = 120
